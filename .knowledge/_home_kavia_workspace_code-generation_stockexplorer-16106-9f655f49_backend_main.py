{"is_source_file": true, "format": "Python", "description": "This is a Python source file that implements a backend API for fetching stock data. It uses FastAPI for the web API, yfinance to retrieve stock information from Yahoo Finance, and sqlite3 for local data storage. The code defines data models, database initialization, caching logic, and API endpoints to serve stock information.", "external_files": ["fastapi", "sqlite3", "os", "datetime", "yfinance"], "external_methods": ["fastapi.FastAPI", "fastapi.HTTPException", "fastapi.middleware.cors.CORSMiddleware", "pydantic.BaseModel", "sqlite3.connect", "datetime.datetime.utcnow", "yf.Ticker"], "published": ["StockResponse"], "classes": [{"name": "StockResponse", "description": "Data model for the stock information returned by the API, extending Pydantic's BaseModel."}], "methods": [{"name": "get_db_conn()", "description": "Returns a new connection to the SQLite database using the configured path.", "scope": "", "scopeKind": ""}, {"name": "init_db()", "description": "Initializes the database by creating the stock_data table if it does not exist.", "scope": "", "scopeKind": ""}, {"name": "save_stock_data(ticker: str, info: dict)", "description": "Stores stock data into the database for a given ticker.", "scope": "", "scopeKind": ""}, {"name": "fetch_recent_stock_data(ticker: str, freshness_secs=300)", "description": "Fetches the most recent stock data for a ticker if it is within a freshness window.", "scope": "", "scopeKind": ""}, {"name": "get_stock(ticker: str)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["get_db_conn()", "init_db()", "save_stock_data()", "fetch_recent_stock_data()", "yf.Ticker()", "stock.info"], "search-terms": ["FastAPI stock API", "yfinance data fetch", "sqlite stock cache", "stock data model", "get_stock endpoint", "database initialization"], "state": 2, "file_id": 20, "knowledge_revision": 47, "git_revision": "0ec1f86cb80daa10ce580ebcfe8f4692e6fccfec", "ctags": [{"_type": "tag", "name": "DB_PATH", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^DB_PATH = os.environ.get(\"STOCK_DB_PATH\", \"stock_data.db\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "StockResponse", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^class StockResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "fetch_recent_stock_data", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^def fetch_recent_stock_data(ticker: str, freshness_secs=300):$/", "language": "Python", "kind": "function", "signature": "(ticker: str, freshness_secs=300)"}, {"_type": "tag", "name": "get_db_conn", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^def get_db_conn():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_stock", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^def get_stock(ticker: str):$/", "language": "Python", "kind": "function", "signature": "(ticker: str)"}, {"_type": "tag", "name": "industry", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    industry: str = \"\"$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "init_db", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^def init_db():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "longName", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    longName: str = \"\"$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "marketCap", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    marketCap: float = None$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "regularMarketChangePercent", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    regularMarketChangePercent: float = None$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "regularMarketPrice", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    regularMarketPrice: float = None$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "save_stock_data", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^def save_stock_data(ticker: str, info: dict):$/", "language": "Python", "kind": "function", "signature": "(ticker: str, info: dict)"}, {"_type": "tag", "name": "sector", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    sector: str = \"\"$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "shortName", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    shortName: str = \"\"$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "timestamp", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    timestamp: float = None$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "website", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^    website: str = \"\"$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "StockResponse", "scopeKind": "class"}, {"_type": "tag", "name": "yf", "path": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "pattern": "/^import yfinance as yf$/", "language": "Python", "kind": "namespace", "nameref": "module:yfinance"}], "filename": "/home/kavia/workspace/code-generation/stockexplorer-16106-9f655f49/backend/main.py", "hash": "81b3e5cae2da0ade6f3d73e142ae0995", "format-version": 4, "code-base-name": "default", "fields": [{"name": "DB_PATH = os.environ.get(\"STOCK_DB_PATH\", \"stock_data.db\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str industry", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str longName", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "float marketCap", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "float regularMarketChangePercent", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "float regularMarketPrice", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str sector", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str shortName", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "float timestamp", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str website", "scope": "StockResponse", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"47": "0ec1f86cb80daa10ce580ebcfe8f4692e6fccfec"}]}